# Story 1.1: Project Initialization & Deployment Pipeline

## Status

Ready

## Story

**As a** developer,
**I want** a Next.js 14+ project with TypeScript initialized, connected to GitHub, and automatically deploying to Vercel,
**so that** we have a working CI/CD pipeline and can iterate rapidly with automatic deployments.

## Acceptance Criteria

1. Next.js 14+ project created with TypeScript and App Router enabled
2. GitHub repository initialized with main branch protection (require PR reviews)
3. Vercel project connected to GitHub repository with automatic deployments on merge to main
4. Environment variables configured in Vercel dashboard (placeholders for API keys to be added later)
5. Health check endpoint `/api/health` returns 200 OK with system status
6. Vercel deployment successful and accessible via HTTPS URL
7. README.md includes setup instructions, environment variable documentation, and deployment process

## Tasks / Subtasks

- [x] Initialize Next.js 14+ project with TypeScript (AC: 1)
  - [x] Run `npx create-next-app@latest` with TypeScript, App Router, ESLint, and Tailwind CSS
  - [x] Verify Next.js version is 14+ in `package.json`
  - [x] Verify TypeScript strict mode is enabled in `tsconfig.json`
  - [x] Configure path aliases in `tsconfig.json` according to architecture: `@/*`, `@sophiaai/services`, `@sophiaai/shared`
  - [x] Test local dev server runs successfully with `npm run dev`

- [ ] Set up GitHub repository and branch protection (AC: 2)
  - [ ] Initialize Git repository with `git init`
  - [ ] Create `.gitignore` with Next.js, TypeScript, and environment file exclusions
  - [ ] Create initial commit with project scaffold
  - [ ] Create GitHub repository (private)
  - [ ] Push code to GitHub `main` branch
  - [ ] Configure branch protection rules: require pull request reviews before merging to `main`

- [ ] Connect Vercel project and configure deployment (AC: 3, 4)
  - [ ] Create Vercel project and link to GitHub repository
  - [ ] Configure automatic deployments: deploy on merge to `main` branch
  - [ ] Set up environment variables in Vercel dashboard (placeholders):
    - `NEXT_PUBLIC_SUPABASE_URL`
    - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
    - `SUPABASE_SERVICE_ROLE_KEY`
    - `UPSTASH_REDIS_REST_URL`
    - `UPSTASH_REDIS_REST_TOKEN`
    - `OPENAI_API_KEY`
    - `WHATSAPP_BUSINESS_ACCOUNT_ID`
    - `WHATSAPP_ACCESS_TOKEN`
    - `WHATSAPP_WEBHOOK_VERIFY_TOKEN`
    - `WHATSAPP_PHONE_NUMBER_ID`
    - `TELEGRAM_BOT_TOKEN`
    - `GMAIL_CLIENT_ID`
    - `GMAIL_CLIENT_SECRET`
    - `GMAIL_REDIRECT_URI`
    - `ZYPRUS_API_KEY`
    - `ZYPRUS_API_BASE_URL`
    - `NEXTAUTH_URL`
    - `NEXTAUTH_SECRET`
    - `NEXT_PUBLIC_SENTRY_DSN`
  - [ ] Trigger initial deployment to Vercel
  - [ ] Verify deployment succeeds and application is accessible via HTTPS URL

- [ ] Implement health check endpoint (AC: 5)
  - [ ] Create `/apps/web/src/app/api/health/route.ts` file
  - [ ] Implement GET handler that returns 200 OK with JSON response: `{ "status": "healthy", "timestamp": "<ISO 8601 timestamp>", "environment": process.env.VERCEL_ENV }`
  - [ ] Test endpoint locally: `curl http://localhost:3000/api/health`
  - [ ] Test endpoint on Vercel deployment: `curl https://<vercel-url>/api/health`

- [ ] Create comprehensive README.md (AC: 7)
  - [ ] Add project overview and purpose
  - [ ] Document setup instructions: Node.js version, npm install, environment variables
  - [ ] Create `.env.example` file with all required environment variables (empty placeholders)
  - [ ] Document deployment process: GitHub push → Vercel automatic deploy
  - [ ] Add development commands: `npm run dev`, `npm run build`, `npm run test`
  - [ ] Include link to architecture documentation: `docs/architecture/`

- [ ] Write unit tests for health check endpoint (AC: 5)
  - [ ] Create test file: `/apps/web/src/app/api/health/__tests__/route.test.ts`
  - [ ] Install Vitest and testing dependencies: `npm install -D vitest @testing-library/react`
  - [ ] Write test: health endpoint returns 200 status
  - [ ] Write test: health endpoint returns correct JSON structure with status, timestamp, and environment fields
  - [ ] Configure Vitest in `vitest.config.ts`
  - [ ] Run tests: `npm run test`
  - [ ] Verify tests pass locally

## Dev Notes

### Previous Story Insights

No specific guidance found in architecture docs (this is the first story)

### Tech Stack

[Source: architecture/3-tech-stack.md]

- **Frontend Framework**: Next.js 14+ with App Router and Server Components
- **Language**: TypeScript 5.x with strict mode enabled
- **UI Library**: React 18+
- **Styling**: Tailwind CSS 3.x
- **Deployment**: Vercel with serverless hosting and CI/CD
- **Version Control**: Git + GitHub with GitHub Actions for CI/CD
- **Testing (Unit)**: Vitest 1.x for fast unit test runner
- **Code Quality**: ESLint 8.x (TypeScript-aware)
- **Code Formatting**: Prettier 3.x

### Project Structure

[Source: architecture/12-unified-project-structure.md]

The project uses a **monorepo structure** with the following organization:

```
sophiaai/
├── .github/workflows/     # CI/CD pipeline configuration
├── apps/web/              # Next.js application
│   ├── src/app/           # Next.js App Router
│   │   └── api/           # API routes
│   ├── package.json
│   ├── tsconfig.json
│   └── vitest.config.ts
├── packages/              # Shared packages (to be added in later stories)
├── docs/                  # Documentation
├── .env.example           # Environment variable template
├── package.json           # Workspace root
├── pnpm-workspace.yaml    # Workspace configuration
└── README.md              # Project documentation
```

**Path Aliases** (configured in `tsconfig.json`):
```json
{
  "paths": {
    "@/*": ["./apps/web/src/*"],
    "@sophiaai/services": ["./packages/services/src"],
    "@sophiaai/shared": ["./packages/shared/src"]
  }
}
```

**Health Check Endpoint Location**: `/apps/web/src/app/api/health/route.ts`

### Environment Variables

[Source: architecture/12-unified-project-structure.md#environment-variables]

All environment variables must be documented in `.env.example` with placeholder values. Required variables for initial setup:

- **Supabase**: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`
- **Upstash Redis**: `UPSTASH_REDIS_REST_URL`, `UPSTASH_REDIS_REST_TOKEN`
- **OpenAI**: `OPENAI_API_KEY`
- **WhatsApp**: `WHATSAPP_BUSINESS_ACCOUNT_ID`, `WHATSAPP_ACCESS_TOKEN`, `WHATSAPP_WEBHOOK_VERIFY_TOKEN`, `WHATSAPP_PHONE_NUMBER_ID`
- **Telegram**: `TELEGRAM_BOT_TOKEN`
- **Gmail OAuth**: `GMAIL_CLIENT_ID`, `GMAIL_CLIENT_SECRET`, `GMAIL_REDIRECT_URI`
- **zyprus.com API**: `ZYPRUS_API_KEY`, `ZYPRUS_API_BASE_URL`
- **Next.js**: `NEXTAUTH_URL`, `NEXTAUTH_SECRET`
- **Sentry**: `NEXT_PUBLIC_SENTRY_DSN`
- **Vercel (auto-populated)**: `VERCEL_ENV`, `VERCEL_GIT_COMMIT_SHA`, `VERCEL_REGION`

### Deployment Configuration

[Source: architecture/14-deployment-architecture.md]

**Environments**:
- **Development**: Local development at `http://localhost:3000`
- **Preview**: PR review at `https://sophiaai-pr-{n}.vercel.app` (auto-deploy on PR)
- **Staging**: Pre-production at `https://staging.sophiaai.com` (auto-deploy on `develop` branch)
- **Production**: Live system at `https://app.sophiaai.com` (auto-deploy on `main` branch after approval)

**CI/CD Pipeline** (GitHub Actions):
- Runs on push to `main` and `develop` branches
- Runs on pull requests
- Jobs: `lint-and-test` (lint, type-check, test, build), `deploy-production` (Vercel deployment for main branch)

### Development Workflow

[Source: architecture/13-development-workflow.md]

**Prerequisites**:
- Node.js v20.x or later
- npm v9.x or later
- Git

**Initial Setup Commands**:
```bash
git clone <repo-url>
cd sophiaai
npm install
cp .env.example .env.local
npm run dev
```

**Development Commands**:
- `npm run dev` - Start development server
- `npm run build` - Build production bundle
- `npm run test` - Run test suite
- `npm run lint` - Run ESLint
- `npm run format` - Format code with Prettier

### Coding Standards

[Source: architecture/17-coding-standards.md]

**TypeScript Configuration**:
- Strict mode enabled
- `noUncheckedIndexedAccess: true`
- `noUnusedLocals: true`
- `noUnusedParameters: true`
- `noFallthroughCasesInSwitch: true`

**Naming Conventions**:
- Files: kebab-case (e.g., `route.ts`, `health.test.ts`)
- Interfaces/Types: PascalCase
- Functions: camelCase
- Constants: UPPER_SNAKE_CASE

**Git Commit Convention**: Conventional Commits format
```
feat(init): initialize Next.js project with TypeScript
feat(api): add health check endpoint
docs(readme): add setup and deployment instructions
```

### Testing

[Source: architecture/16-testing-strategy.md]

**Test Framework**: Vitest 1.x (fast, Vite-native test runner)

**Test Coverage Requirements**:
- API Routes: >70%
- Overall: >75%

**Test File Location**: Tests should be co-located with the code they test in `__tests__` directories
- Health check tests: `/apps/web/src/app/api/health/__tests__/route.test.ts`

**Example Unit Test Pattern**:
```typescript
describe('Health Check API', () => {
  it('should return 200 status', async () => {
    const response = await fetch('/api/health');
    expect(response.status).toBe(200);
  });

  it('should return correct JSON structure', async () => {
    const response = await fetch('/api/health');
    const data = await response.json();
    expect(data).toHaveProperty('status', 'healthy');
    expect(data).toHaveProperty('timestamp');
    expect(data).toHaveProperty('environment');
  });
});
```

### Technical Constraints

- **Node.js Version**: v20.x or later required [Source: architecture/13-development-workflow.md#prerequisites]
- **Next.js Version**: 14+ required [Source: architecture/3-tech-stack.md]
- **TypeScript Version**: 5.x with strict mode [Source: architecture/3-tech-stack.md]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| TBD | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_This section will be populated by the QA Agent after story completion._
